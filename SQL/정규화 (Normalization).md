#sql #database #normalization #정규화 #면접 #개념정리

**관련 개념:** [[RDBMS (관계형 데이터베이스 관리 시스템)|RDBMS]] [[JPA와 ORM (SQL 중심 개발 vs ORM)|JPA와 ORM]]

> [!note] 이어서 읽기
> 정규화를 이해하려면 **[[RDBMS (관계형 데이터베이스 관리 시스템)|RDBMS]]**의 핵심 개념을 함께 확인하세요.

---

## Topic (오늘의 주제)

**정규화(Normalization)**는 데이터베이스 설계에서 데이터 중복을 최소화하고 데이터 무결성을 보장하기 위해 테이블을 분해하는 과정이다. 정규화를 통해 데이터의 일관성, 무결성, 효율성을 향상시킬 수 있다.

---

### **Why (왜 사용하는가? 왜 중요한가?)**

- 비정규화된 테이블에서는 데이터 중복, 갱신 이상(Update Anomaly), 삽입 이상(Insert Anomaly), 삭제 이상(Delete Anomaly) 등의 문제가 발생합니다. 예를 들어, 도서관에서 한 책의 정보를 수정하려면 여러 행을 모두 수정해야 하고, 책이 삭제되면 관련된 모든 대출 정보가 함께 삭제되는 문제가 발생할 수 있습니다.

- 정규화를 통해 데이터 중복을 제거하고, 각 테이블이 단일 책임을 가지도록 분리하여 데이터 무결성을 보장합니다. 이를 통해 데이터 일관성을 유지하고, 저장 공간을 절약하며, 데이터베이스 성능을 최적화할 수 있습니다.

- 정규화의 각 단계(1NF, 2NF, 3NF, BCNF 등)를 이해하고, 언제 정규화를 적용하고 언제 비정규화를 고려해야 하는지 판단할 수 있어야 합니다.

---

## 1. 정규화의 목적

### **정규화를 통해 해결하는 문제들**

1. **데이터 중복 제거**: 같은 데이터가 여러 곳에 저장되는 것을 방지
2. **데이터 무결성 보장**: 데이터의 일관성과 정확성 유지
3. **갱신 이상 방지**: 한 곳에서만 데이터를 수정하면 모든 곳에 반영
4. **삽입 이상 방지**: 불필요한 데이터 없이 새로운 데이터 추가 가능
5. **삭제 이상 방지**: 관련 없는 데이터가 함께 삭제되는 것을 방지

---

## 2. 정규화 단계

### **1NF (제1정규형, First Normal Form)**

**정의**: 각 컬럼이 원자값(Atomic Value)만을 가지도록 하는 것. 즉, 하나의 셀에는 하나의 값만 저장되어야 한다.

**도서관 예시 - 정규화 전:**

| 대출ID | 회원번호 | 회원이름 | 도서번호 | 도서제목 | 저자 | 출판사 | 대출일 | 반납예정일 |
|--------|---------|---------|---------|---------|------|--------|--------|-----------|
| 1 | M001 | 김철수 | B001, B002 | 자바의정석, 스프링부트 | 남궁성, 김영한 | 도우출판, 에이콘 | 2024-01-15 | 2024-02-15 |
| 2 | M002 | 이영희 | B003 | 데이터베이스 | 홍길동 | 한빛미디어 | 2024-01-20 | 2024-02-20 |

**문제점:**
- 한 행에 여러 도서 정보가 저장되어 있음 (비원자값)
- 도서 정보를 조회하거나 수정하기 어려움
- 데이터 중복 발생

**1NF 적용 후:**

| 대출ID | 회원번호 | 회원이름 | 도서번호 | 도서제목 | 저자 | 출판사 | 대출일 | 반납예정일 |
|--------|---------|---------|---------|---------|------|--------|--------|-----------|
| 1 | M001 | 김철수 | B001 | 자바의정석 | 남궁성 | 도우출판 | 2024-01-15 | 2024-02-15 |
| 2 | M001 | 김철수 | B002 | 스프링부트 | 김영한 | 에이콘 | 2024-01-15 | 2024-02-15 |
| 3 | M002 | 이영희 | B003 | 데이터베이스 | 홍길동 | 한빛미디어 | 2024-01-20 | 2024-02-20 |

**개선점:**
- 각 셀에 하나의 값만 저장 (원자값)
- 도서별로 별도의 행으로 분리

---

### **2NF (제2정규형, Second Normal Form)**

**정의**: 1NF를 만족하면서, 부분 함수 종속(Partial Functional Dependency)을 제거하는 것. 즉, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되어야 한다.

**도서관 예시 - 1NF 상태 (여전히 문제 있음):**

| 대출ID | 회원번호 | 회원이름 | 도서번호 | 도서제목 | 저자 | 출판사 | 대출일 | 반납예정일 |
|--------|---------|---------|---------|---------|------|--------|--------|-----------|
| 1 | M001 | 김철수 | B001 | 자바의정석 | 남궁성 | 도우출판 | 2024-01-15 | 2024-02-15 |
| 2 | M001 | 김철수 | B002 | 스프링부트 | 김영한 | 에이콘 | 2024-01-15 | 2024-02-15 |
| 3 | M002 | 이영희 | B003 | 데이터베이스 | 홍길동 | 한빛미디어 | 2024-01-20 | 2024-02-20 |

**문제점:**
- 기본키: `대출ID`
- `회원이름`은 `회원번호`에만 종속 (부분 함수 종속)
- `도서제목`, `저자`, `출판사`는 `도서번호`에만 종속 (부분 함수 종속)
- 회원 정보나 도서 정보를 수정하려면 여러 행을 수정해야 함 (갱신 이상)

**2NF 적용 후:**

**대출 테이블 (대출ID가 기본키):**

| 대출ID | 회원번호 | 도서번호 | 대출일 | 반납예정일 |
|--------|---------|---------|--------|-----------|
| 1 | M001 | B001 | 2024-01-15 | 2024-02-15 |
| 2 | M001 | B002 | 2024-01-15 | 2024-02-15 |
| 3 | M002 | B003 | 2024-01-20 | 2024-02-20 |

**회원 테이블 (회원번호가 기본키):**

| 회원번호 | 회원이름 | 전화번호 | 주소 |
|---------|---------|---------|------|
| M001 | 김철수 | 010-1234-5678 | 서울시 강남구 |
| M002 | 이영희 | 010-9876-5432 | 서울시 서초구 |

**도서 테이블 (도서번호가 기본키):**

| 도서번호 | 도서제목 | 저자 | 출판사 | 출판일 |
|---------|---------|------|--------|--------|
| B001 | 자바의정석 | 남궁성 | 도우출판 | 2020-01-01 |
| B002 | 스프링부트 | 김영한 | 에이콘 | 2021-03-15 |
| B003 | 데이터베이스 | 홍길동 | 한빛미디어 | 2019-06-20 |

**개선점:**
- 각 테이블이 단일 주제에 집중
- 회원 정보나 도서 정보를 한 곳에서만 수정하면 됨
- 데이터 중복 제거

---

### **3NF (제3정규형, Third Normal Form)**

**정의**: 2NF를 만족하면서, 이행적 함수 종속(Transitive Functional Dependency)을 제거하는 것. 즉, 기본키가 아닌 속성 간의 종속 관계를 제거해야 한다.

**도서관 예시 - 2NF 상태 (여전히 문제 있음):**

**도서 테이블:**

| 도서번호 | 도서제목 | 저자 | 출판사 | 출판사주소 | 출판사전화 |
|---------|---------|------|--------|-----------|-----------|
| B001 | 자바의정석 | 남궁성 | 도우출판 | 서울시 마포구 | 02-1234-5678 |
| B002 | 스프링부트 | 김영한 | 에이콘 | 서울시 강남구 | 02-2345-6789 |
| B003 | 데이터베이스 | 홍길동 | 한빛미디어 | 서울시 서초구 | 02-3456-7890 |
| B004 | 알고리즘 | 홍길동 | 한빛미디어 | 서울시 서초구 | 02-3456-7890 |

**문제점:**
- `출판사주소`, `출판사전화`는 `출판사`에 종속 (이행적 함수 종속)
- 같은 출판사의 정보가 여러 행에 중복 저장됨
- 출판사 정보를 수정하려면 여러 행을 수정해야 함 (갱신 이상)

**3NF 적용 후:**

**도서 테이블:**

| 도서번호 | 도서제목 | 저자 | 출판사코드 |
|---------|---------|------|-----------|
| B001 | 자바의정석 | 남궁성 | P001 |
| B002 | 스프링부트 | 김영한 | P002 |
| B003 | 데이터베이스 | 홍길동 | P003 |
| B004 | 알고리즘 | 홍길동 | P003 |

**출판사 테이블 (출판사코드가 기본키):**

| 출판사코드 | 출판사명 | 출판사주소 | 출판사전화 |
|-----------|---------|-----------|-----------|
| P001 | 도우출판 | 서울시 마포구 | 02-1234-5678 |
| P002 | 에이콘 | 서울시 강남구 | 02-2345-6789 |
| P003 | 한빛미디어 | 서울시 서초구 | 02-3456-7890 |

**개선점:**
- 출판사 정보가 한 곳에만 저장됨
- 출판사 정보 수정 시 한 행만 수정하면 됨
- 데이터 중복 완전 제거

---

### **BCNF (Boyce-Codd Normal Form)**

**정의**: 3NF를 만족하면서, 모든 결정자(Determinant)가 후보키(Candidate Key)가 되도록 하는 것. 즉, 후보키가 아닌 속성이 다른 속성을 결정하는 것을 방지한다.

**도서관 예시 - 3NF 상태 (특수한 경우 문제 발생 가능):**

**대출 테이블:**

| 대출ID | 회원번호 | 도서번호 | 대출일 | 반납예정일 |
|--------|---------|---------|--------|-----------|
| 1 | M001 | B001 | 2024-01-15 | 2024-02-15 |
| 2 | M001 | B002 | 2024-01-15 | 2024-02-15 |

**도서 테이블:**

| 도서번호 | 도서제목 | 저자 | 출판사코드 | 저자이메일 |
|---------|---------|------|-----------|-----------|
| B001 | 자바의정석 | 남궁성 | P001 | namgung@email.com |
| B002 | 스프링부트 | 김영한 | P002 | kim@email.com |

**문제점 (가정):**
- 만약 `저자이메일`이 `저자`에만 종속되고, `도서번호`와는 독립적이라면?
- 같은 저자가 여러 도서를 쓸 경우 `저자이메일`이 중복됨
- 하지만 `저자`가 후보키가 아니므로 3NF는 만족하지만 BCNF는 위반

**BCNF 적용 후:**

**도서 테이블:**

| 도서번호 | 도서제목 | 저자코드 | 출판사코드 |
|---------|---------|---------|-----------|
| B001 | 자바의정석 | A001 | P001 |
| B002 | 스프링부트 | A002 | P002 |

**저자 테이블 (저자코드가 기본키):**

| 저자코드 | 저자명 | 저자이메일 |
|---------|--------|-----------|
| A001 | 남궁성 | namgung@email.com |
| A002 | 김영한 | kim@email.com |

**개선점:**
- 모든 결정자가 후보키가 됨
- 더 엄격한 정규화로 데이터 무결성 강화

---

## 3. 정규화의 장단점

### **장점**

1. **데이터 중복 제거**: 저장 공간 절약
2. **데이터 무결성 보장**: 일관성 유지
3. **갱신 이상 방지**: 한 곳에서만 수정
4. **삽입/삭제 이상 방지**: 독립적인 데이터 관리
5. **유지보수 용이**: 구조가 명확함

### **단점**

1. **테이블 수 증가**: 조인 연산이 많아짐
2. **성능 저하 가능성**: 복잡한 쿼리로 인한 성능 저하
3. **복잡도 증가**: 설계와 쿼리가 복잡해짐

---

## 4. 비정규화 (Denormalization)

### **비정규화란?**

정규화된 데이터베이스를 성능 향상을 위해 일부러 중복을 허용하는 것을 말한다.

### **비정규화를 고려하는 경우**

1. **조회 성능이 중요한 경우**: 자주 조회되는 데이터를 중복 저장
2. **읽기 중심의 애플리케이션**: 읽기 작업이 쓰기 작업보다 훨씬 많은 경우
3. **복잡한 조인 회피**: 자주 함께 조회되는 데이터를 한 테이블에 저장

### **도서관 예시 - 비정규화 적용**

**정규화된 상태 (3NF):**

```sql
-- 대출 정보 조회 시 조인 필요
SELECT 
    l.대출ID,
    m.회원이름,
    b.도서제목,
    b.저자,
    l.대출일
FROM 대출 l
JOIN 회원 m ON l.회원번호 = m.회원번호
JOIN 도서 b ON l.도서번호 = b.도서번호;
```

**비정규화 적용 (성능 향상):**

| 대출ID | 회원번호 | 회원이름 | 도서번호 | 도서제목 | 저자 | 대출일 | 반납예정일 |
|--------|---------|---------|---------|---------|------|--------|-----------|
| 1 | M001 | 김철수 | B001 | 자바의정석 | 남궁성 | 2024-01-15 | 2024-02-15 |

**장점:**
- 조인 없이 빠른 조회 가능
- 자주 조회되는 정보를 한 번에 가져옴

**단점:**
- 도서 정보 수정 시 여러 행을 수정해야 함
- 데이터 일관성 유지가 어려움

---

## 5. 정규화 실무 가이드

### **정규화를 적용해야 하는 경우**

1. **데이터 일관성이 중요한 경우**: 금융, 의료 등 정확성이 중요한 시스템
2. **쓰기 작업이 많은 경우**: 데이터 수정이 빈번한 시스템
3. **저장 공간이 제한적인 경우**: 중복 데이터를 최소화해야 하는 경우

### **비정규화를 고려해야 하는 경우**

1. **읽기 성능이 중요한 경우**: 조회가 매우 빈번한 시스템
2. **데이터 웨어하우스**: 분석용 데이터베이스
3. **캐싱이 어려운 경우**: 실시간 조회가 필요한 경우

### **균형점 찾기**

- **일반적으로 3NF까지 정규화**: 대부분의 경우 3NF가 적절한 균형점
- **성능 문제 발생 시 비정규화 고려**: 조인으로 인한 성능 저하가 명확할 때
- **데이터 일관성 우선**: 정규화를 기본으로 하고, 필요시에만 비정규화

---

## 요약

- **정규화**는 데이터 중복을 제거하고 데이터 무결성을 보장하기 위해 테이블을 분해하는 과정입니다.
- **1NF**: 원자값만 저장 (하나의 셀에 하나의 값)
- **2NF**: 부분 함수 종속 제거 (기본키에 완전 종속)
- **3NF**: 이행적 함수 종속 제거 (기본키가 아닌 속성 간 종속 제거)
- **BCNF**: 모든 결정자가 후보키가 되도록 함
- 정규화는 데이터 일관성을 보장하지만, 과도한 정규화는 성능 저하를 일으킬 수 있습니다.
- 실무에서는 **3NF까지 정규화**를 기본으로 하고, 성능 문제가 발생할 때만 비정규화를 고려합니다.

---

## 참고 자료

- [Database Normalization - Wikipedia](https://en.wikipedia.org/wiki/Database_normalization)
- [Normalization in DBMS - GeeksforGeeks](https://www.geeksforgeeks.org/normalization-in-dbms/)
- [Database Design - Normalization](https://www.studytonight.com/dbms/database-normalization.php)
